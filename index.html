<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'impostore</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* Puoi aggiungere qui stili CSS personalizzati se necessario, anche se Tailwind gestisce la maggior parte del design. */
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div id="game-container" class="bg-white rounded-lg shadow-xl p-8 w-full max-w-4xl">
        <h1 class="text-4xl font-bold text-center text-gray-800 mb-2">L'impostore</h1>
        <h2 class="text-xl text-center text-gray-600 mb-8">Anche oggi Matteo non ha portato le carte</h2>

        <div id="player-input-screen" class="space-y-4">
            <p class="text-center text-gray-700">Inserisci i nomi dei giocatori (da 3 a 14):</p>
            <div id="player-inputs" class="space-y-2">
                <input type="text" class="player-name-input w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nome giocatore 1">
                <input type="text" class="player-name-input w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nome giocatore 2">
                <input type="text" class="player-name-input w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Nome giocatore 3">
            </div>
            <p id="player-input-error" class="text-red-500 text-center hidden">Inserisci tra 3 e 14 nomi.</p>
            <button id="start-game-button" class="w-full bg-blue-600 text-white py-3 rounded-md hover:bg-blue-700 transition duration-300">Inizia Partita</button>
        </div>

        <div id="game-screen" class="hidden">
            <div id="player-cards" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-8">
                </div>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <button id="new-round-button" class="bg-green-600 text-white py-3 px-6 rounded-md hover:bg-green-700 transition duration-300">Nuova Partita (Stessi Giocatori)</button>
                <button id="reset-game-button" class="bg-red-600 text-white py-3 px-6 rounded-md hover:bg-red-700 transition duration-300">Azzera Tutto e Rigioca</button>
            </div>
        </div>

        <div id="role-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
            <div class="bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center">
                <p class="text-xl text-gray-700 mb-4">Il tuo ruolo è:</p>
                <p id="modal-role" class="text-3xl font-bold text-blue-600 mb-6"></p>
                <p id="modal-word-container" class="text-xl text-gray-700 mb-2 hidden">La parola è:</p>
                <p id="modal-word" class="text-3xl font-bold text-purple-700"></p>
                <p id="modal-countdown" class="text-sm text-gray-500 mt-6"></p>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const playerInputScreen = document.getElementById('player-input-screen');
            const gameScreen = document.getElementById('game-screen');
            const playerInputsContainer = document.getElementById('player-inputs');
            const startGameButton = document.getElementById('start-game-button');
            const playerInputError = document.getElementById('player-input-error');
            const playerCardsContainer = document.getElementById('player-cards');
            const newRoundButton = document.getElementById('new-round-button');
            const resetGameButton = document.getElementById('reset-game-button');
            const roleModal = document.getElementById('role-modal');
            const modalRole = document.getElementById('modal-role');
            const modalWordContainer = document.getElementById('modal-word-container');
            const modalWord = document.getElementById('modal-word');
            const modalCountdown = document.getElementById('modal-countdown');

            let players = [];
            let secretWord = '';
            let imposterIndex = -1;
            let revealedPlayers = new Set();
            let playersCount = 3; // Inizialmente 3 input per i nomi

            const italianWords = [
                "tavolo", "sedia", "libro", "penna", "computer", "telefono", "porta", "finestra", "muro", "tetto",
                "strada", "auto", "bici", "treno", "aereo", "nave", "cielo", "sole", "luna", "stella",
                "albero", "fiore", "erba", "frutta", "verdura", "pane", "latte", "acqua", "caffè", "tè",
                "carne", "pesce", "formaggio", "uovo", "riso", "pasta", "pizza", "sale", "zucchero", "miele",
                "mano", "piede", "testa", "occhio", "naso", "bocca", "orecchio", "braccio", "gamba", "cuore",
                "casa", "scuola", "ufficio", "negozio", "ospedale", "banca", "chiesa", "parco", "giardino", "piazza",
                "montagna", "fiume", "lago", "mare", "isola", "spiaggia", "deserto", "foresta", "città", "paese",
                "rosso", "blu", "verde", "giallo", "nero", "bianco", "grigio", "marrone", "rosa", "viola",
                "giorno", "notte", "mattina", "sera", "oggi", "ieri", "domani", "settimana", "mese", "anno",
                "tempo", "ora", "minuto", "secondo", "vita", "morte", "amore", "odio", "pace", "guerra",
                "gioia", "tristezza", "rabbia", "paura", "coraggio", "speranza", "fortuna", "sfortuna", "verità", "bugia",
                "suono", "luce", "ombra", "calore", "freddo", "vento", "pioggia", "neve", "nuvola", "fulmine",
                "ferro", "oro", "argento", "rame", "legno", "vetro", "plastica", "carta", "stoffa", "gomma",
                "sport", "gioco", "musica", "arte", "cinema", "teatro", "danza", "libro", "poesia", "storia",
                "futuro", "passato", "presente", "problema", "soluzione", "domanda", "risposta", "idea", "sogno", "realtà",
                "lavoro", "studio", "vacanza", "viaggio", "festa", "evento", "incontro", "amicizia", "famiglia", "relazione",
                "silenzio", "rumore", "voce", "canto", "grido", "sussurro", "risata", "pianto", "segreto", "indizio",
                "regola", "legge", "giustizia", "libertà", "diritto", "dovere", "errore", "successo", "fallimento", "sfida",
                "salute", "malattia", "medicina", "dottore", "infermiere", "paziente", "cura", "rimedio", "dolore", "benessere",
                "felicità", "tristezza", "stress", "relax", "energia", "fatica", "forza", "debolezza", "talento", "abilità",
                "velocità", "lentezza", "distanza", "vicinanza", "altezza", "profondità", "larghezza", "lunghezza", "peso", "leggero",
                "forma", "colore", "odore", "sapore", "tatto", "vista", "udito", "olfatto", "gusto", "senso",
                "mente", "corpo", "anima", "spirito", "pensiero", "emozione", "sentimento", "coscienza", "inconscio", "istinto",
                "conoscenza", "saggezza", "ignoranza", "verità", "menzogna", "dubbio", "certezza", "fede", "ragione", "fantasia",
                "oggetto", "strumento", "macchina", "motore", "ruota", "ingranaggio", "leva", "corda", "catena", "filo",
                "tessuto", "metallo", "pietra", "sabbia", "fango", "polvere", "cenere", "fumo", "vapore", "liquido",
                "solido", "gas", "energia", "materia", "universo", "pianeta", "galassia", "cometa", "asteroide", "spazio",
                "tempo", "destino", "causa", "effetto", "origine", "fine", "principio", "conseguenza", "scopo", "mezzo",
                "azione", "reazione", "cambiamento", "sviluppo", "progresso", "crisi", "soluzione", "decisione", "scelta", "errore",
                "vittoria", "sconfitta", "partita", "regola", "obiettivo", "strategia", "tattica", "giocatore", "squadra", "arbitro",
                "cuoco", "cameriere", "insegnante", "studente", "ingegnere", "architetto", "artista", "medico", "avvocato", "operaio",
                "gatto", "cane", "uccello", "pesce", "cavallo", "mucca", "maiale", "pecora", "lupo", "leone",
                "tigre", "orso", "scimmia", "elefante", "giraffa", "serpente", "rana", "ragno", "farfalla", "ape",
                "formica", "mosca", "zanzara", "grillo", "lumaca", "chiocciola", "coniglio", "volpe", "cinghiale", "cervo"
            ];

            // Funzione per aggiungere dinamicamente i campi input per i nomi
            function addPlayerInput() {
                const currentInputs = document.querySelectorAll('.player-name-input');
                if (currentInputs.length < 14) {
                    const newInput = document.createElement('input');
                    newInput.type = 'text';
                    newInput.className = 'player-name-input w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500';
                    newInput.placeholder = `Nome giocatore ${currentInputs.length + 1}`;
                    playerInputsContainer.appendChild(newInput);
                    playersCount++;
                    newInput.addEventListener('input', handlePlayerNameInput);
                }
            }

            // Funzione per rimuovere input vuoti se ci sono più di 3 input
            function removeEmptyPlayerInput() {
                const currentInputs = Array.from(document.querySelectorAll('.player-name-input'));
                if (currentInputs.length > 3) {
                    // Trova l'ultimo input non vuoto
                    let lastFilledInputIndex = -1;
                    for (let i = currentInputs.length - 1; i >= 0; i--) {
                        if (currentInputs[i].value.trim() !== '') {
                            lastFilledInputIndex = i;
                            break;
                        }
                    }

                    // Rimuovi gli input vuoti dopo l'ultimo input non vuoto, ma mantieni almeno 3 input totali
                    for (let i = currentInputs.length - 1; i > Math.max(2, lastFilledInputIndex); i--) {
                        if (currentInputs[i].value.trim() === '') {
                            playerInputsContainer.removeChild(currentInputs[i]);
                            playersCount--;
                        }
                    }
                }
            }

            // Gestore per l'input dei nomi
            function handlePlayerNameInput() {
                const currentInputs = document.querySelectorAll('.player-name-input');
                const lastInput = currentInputs[currentInputs.length - 1];

                // Aggiungi un nuovo input se l'ultimo non è vuoto e non abbiamo raggiunto il massimo
                if (lastInput && lastInput.value.trim() !== '' && currentInputs.length < 14) {
                    addPlayerInput();
                } else if (currentInputs.length > 3) {
                    // Rimuovi input vuoti se non sono i primi 3
                    removeEmptyPlayerInput();
                }
            }

            // Inizializza i primi 3 input e aggiungi listener
            for (let i = 0; i < playersCount; i++) {
                const input = document.querySelectorAll('.player-name-input')[i];
                if (input) {
                    input.addEventListener('input', handlePlayerNameInput);
                }
            }

            // Funzione per mescolare l'array (Fisher-Yates)
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Funzione per iniziare una nuova partita o un nuovo round
            function initializeGame(keepPlayers = false) {
                playerInputError.classList.add('hidden');
                revealedPlayers.clear();

                if (!keepPlayers) {
                    const playerNames = Array.from(document.querySelectorAll('.player-name-input'))
                                        .map(input => input.value.trim())
                                        .filter(name => name !== '');

                    if (playerNames.length < 3 || playerNames.length > 14) {
                        playerInputError.classList.remove('hidden');
                        return;
                    }
                    players = playerNames.map(name => ({ name: name, role: '', revealed: false }));
                } else {
                    // Resetta solo il ruolo e lo stato di rivelazione per i giocatori esistenti
                    players.forEach(player => {
                        player.role = '';
                        player.revealed = false;
                    });
                }

                // Assegna la parola segreta
                secretWord = italianWords[Math.floor(Math.random() * italianWords.length)];

                // Assegna i ruoli casualmente
                const playerIndices = Array.from({ length: players.length }, (_, i) => i);
                shuffleArray(playerIndices);
                imposterIndex = playerIndices[0]; // Il primo indice mescolato è l'impostore

                players.forEach((player, index) => {
                    if (index === imposterIndex) {
                        player.role = 'Impostore';
                    } else {
                        player.role = 'Socio';
                    }
                });

                renderPlayerCards();
                playerInputScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
            }

            // Funzione per generare le carte dei giocatori
            function renderPlayerCards() {
                playerCardsContainer.innerHTML = '';
                players.forEach((player, index) => {
                    const card = document.createElement('div');
                    card.id = `player-card-${index}`;
                    card.dataset.index = index;
                    card.classList.add(
                        'player-card',
                        'bg-blue-500',
                        'text-white',
                        'p-6',
                        'rounded-lg',
                        'shadow-md',
                        'text-center',
                        'cursor-pointer',
                        'transform',
                        'transition',
                        'duration-300',
                        'hover:scale-105',
                        'flex',
                        'items-center',
                        'justify-center',
                        'text-2xl',
                        'font-semibold'
                    );
                    card.textContent = player.name;

                    if (player.revealed) {
                        card.classList.add('bg-gray-400', 'cursor-not-allowed', 'opacity-70', 'pointer-events-none');
                        card.classList.remove('bg-blue-500', 'hover:scale-105');
                    } else {
                        card.addEventListener('click', handleCardClick);
                    }
                    playerCardsContainer.appendChild(card);
                });
            }

            // Funzione per gestire il click sulla carta del giocatore
            function handleCardClick(event) {
                const card = event.currentTarget;
                const index = parseInt(card.dataset.index);
                const player = players[index];

                if (player.revealed) {
                    return; // Impedisce multiple rivelazioni
                }

                modalRole.textContent = player.role;
                if (player.role === 'Socio') {
                    modalWordContainer.classList.remove('hidden');
                    modalWord.textContent = secretWord;
                    modalRole.classList.remove('text-red-600');
                    modalRole.classList.add('text-blue-600');
                } else {
                    modalWordContainer.classList.add('hidden');
                    modalWord.textContent = 'Non hai una parola segreta!';
                    modalRole.classList.remove('text-blue-600');
                    modalRole.classList.add('text-red-600');
                }

                roleModal.classList.remove('hidden');

                let countdown = 5;
                modalCountdown.textContent = `Il modale si chiuderà tra ${countdown} secondi...`;

                const countdownInterval = setInterval(() => {
                    countdown--;
                    modalCountdown.textContent = `Il modale si chiuderà tra ${countdown} secondi...`;
                    if (countdown <= 0) {
                        clearInterval(countdownInterval);
                        roleModal.classList.add('hidden');
                        player.revealed = true; // Marca il giocatore come rivelato
                        card.classList.add('bg-gray-400', 'cursor-not-allowed', 'opacity-70', 'pointer-events-none');
                        card.classList.remove('bg-blue-500', 'hover:scale-105');
                        card.removeEventListener('click', handleCardClick);
                    }
                }, 1000);
            }

            // Event Listener per il bottone "Inizia Partita"
            startGameButton.addEventListener('click', () => initializeGame(false));

            // Event Listener per il bottone "Nuova Partita (Stessi Giocatori)"
            newRoundButton.addEventListener('click', () => initializeGame(true));

            // Event Listener per il bottone "Azzera Tutto e Rigioca"
            resetGameButton.addEventListener('click', () => {
                players = [];
                secretWord = '';
                imposterIndex = -1;
                revealedPlayers.clear();
                playerCardsContainer.innerHTML = '';
                playerInputsContainer.innerHTML = ''; // Pulisce gli input
                playersCount = 3; // Resetta a 3 input

                // Ricrea i primi 3 input e aggiungi listener
                for (let i = 1; i <= 3; i++) {
                    const newInput = document.createElement('input');
                    newInput.type = 'text';
                    newInput.className = 'player-name-input w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500';
                    newInput.placeholder = `Nome giocatore ${i}`;
                    playerInputsContainer.appendChild(newInput);
                    newInput.addEventListener('input', handlePlayerNameInput);
                }

                playerInputScreen.classList.remove('hidden');
                gameScreen.classList.add('hidden');
                playerInputError.classList.add('hidden');
            });
        });
    </script>
</body>
</html>
