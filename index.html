<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'impostore</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top to allow scrolling */
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background-color: #2d3748; /* Slightly lighter dark background for container */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 800px;
            text-align: center;
            position: relative;
        }
        .player-card {
            background-color: #4a5568;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, background-color 0.2s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            font-weight: 600;
            text-align: center;
            min-height: 80px; /* Ensure cards have a minimum height */
        }
        .player-card:hover:not(.revealed) {
            transform: translateY(-5px);
            background-color: #636b7a;
        }
        .player-card.revealed {
            background-color: #2c3748; /* Darker when revealed */
            color: #a0aec0; /* Dimmed text when revealed */
            cursor: not-allowed;
            opacity: 0.7;
            box-shadow: none;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.7); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background-color: #2d3748;
            margin: auto;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 15px 25px rgba(0, 0, 0, 0.4);
            text-align: center;
            max-width: 500px;
            width: 90%;
            animation: fadeIn 0.3s ease-out;
            border: 2px solid #4299e1; /* Blue border for emphasis */
        }
        .modal-role {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #4299e1; /* Blue for role */
        }
        .modal-word {
            font-size: 2rem;
            font-weight: 600;
            color: #a0aec0; /* Light gray for word */
        }
        .modal-impostore {
            color: #fc8181; /* Red for impostor */
        }
        .modal-socio {
            color: #68d391; /* Green for socio */
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .input-group label {
            text-align: left;
            font-weight: 600;
            color: #a0aec0;
        }
        .input-group input {
            background-color: #4a5568;
            border: 1px solid #636b7a;
            color: #e2e8f0;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }
        .input-group input:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-primary {
            background-color: #4299e1; /* Blue */
            color: white;
        }
        .btn-primary:hover {
            background-color: #3182ce; /* Darker blue */
            transform: translateY(-2px);
        }
        .btn-secondary {
            background-color: #e53e3e; /* Red */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #c53030; /* Darker red */
            transform: translateY(-2px);
        }
        .btn-tertiary {
            background-color: #f6ad55; /* Orange */
            color: white;
        }
        .btn-tertiary:hover {
            background-color: #dd6b20; /* Darker orange */
            transform: translateY(-2px);
        }
        .hidden {
            display: none;
        }
        .grid-players {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .container {
                padding: 1rem;
            }
            .modal-content {
                padding: 1.5rem;
            }
            .modal-role {
                font-size: 2rem;
            }
            .modal-word {
                font-size: 1.5rem;
            }
            .btn-group {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1 class="text-4xl font-bold mb-2 text-blue-400">L'impostore</h1>
        <h2 class="text-lg text-gray-400 mb-6">Anche oggi Matteo non ha portato le carte</h2>

        <!-- Player Name Input Section -->
        <div id="player-input-section">
            <p class="text-gray-300 mb-4">Inserisci i nomi dei giocatori (da 3 a 10):</p>
            <div id="player-name-inputs" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <!-- Inputs will be dynamically added here by JS -->
            </div>
            <button id="start-game-btn" class="btn btn-primary w-full md:w-auto">Inizia Partita</button>
        </div>

        <!-- Game Play Section -->
        <div id="game-play-section" class="hidden">
            <p class="text-gray-300 mb-4">Clicca sulla tua carta per rivelare il tuo ruolo!</p>
            <div id="player-cards-container" class="grid-players">
                <!-- Player cards will be dynamically added here by JS -->
            </div>
            <div class="flex flex-col md:flex-row justify-center gap-4 mt-8 btn-group">
                <button id="new-round-same-players-btn" class="btn btn-tertiary w-full md:w-auto">Nuova Partita (Stessi Giocatori)</button>
                <button id="reset-all-game-btn" class="btn btn-secondary w-full md:w-auto">Azzera Tutto e Rigioca</button>
            </div>
        </div>
    </div>

    <!-- Modal for Role/Word Display -->
    <div id="role-modal" class="modal">
        <div class="modal-content">
            <p class="text-gray-400 text-xl mb-2">Il tuo ruolo è:</p> <!-- Added explanatory phrase -->
            <p class="modal-role" id="modal-role-text"></p>
            <p class="text-gray-400 text-xl mt-4 mb-2">La parola è:</p> <!-- Added explanatory phrase -->
            <p class="modal-word" id="modal-word-text"></p>
            <p class="text-gray-500 text-sm mt-6">Questa finestra si chiuderà automaticamente.</p>
        </div>
    </div>

    <script>
        // Array di parole italiane (almeno 500 parole)
        // Ho incluso un ampio set di parole comuni per soddisfare il requisito.
        const italianWords = [
            "casa", "albero", "sole", "mare", "cielo", "fiore", "libro", "tavolo", "sedia", "porta",
            "finestra", "strada", "città", "paese", "montagna", "fiume", "lago", "ponte", "auto", "treno",
            "aereo", "nave", "bici", "moto", "telefono", "computer", "musica", "arte", "storia", "scienza",
            "sport", "gioco", "amico", "famiglia", "lavoro", "scuola", "università", "ospedale", "medico", "infermiere",
            "cibo", "acqua", "pane", "latte", "carne", "pesce", "frutta", "verdura", "dolce", "sale",
            "zucchero", "caffè", "tè", "vino", "birra", "bicchiere", "piatto", "forchetta", "coltello", "cucchiaio",
            "gatto", "cane", "uccello", "leone", "tigre", "elefante", "cavallo", "mucca", "pecora", "gallina",
            "uovo", "formaggio", "burro", "miele", "pioggia", "neve", "vento", "nuvola", "fulmine", "tuono",
            "caldo", "freddo", "giorno", "notte", "mattina", "sera", "oggi", "domani", "ieri", "ora",
            "minuto", "secondo", "anno", "mese", "settimana", "primavera", "estate", "autunno", "inverno", "colore",
            "rosso", "blu", "verde", "giallo", "nero", "bianco", "grigio", "rosa", "viola", "arancione",
            "grande", "piccolo", "alto", "basso", "largo", "stretto", "lungo", "corto", "nuovo", "vecchio",
            "buono", "cattivo", "bello", "brutto", "facile", "difficile", "veloce", "lento", "forte", "debole",
            "aperto", "chiuso", "pieno", "vuoto", "pulito", "sporco", "destra", "sinistra", "avanti", "indietro",
            "sopra", "sotto", "dentro", "fuori", "vicino", "lontano", "qui", "lì", "dove", "quando",
            "come", "perché", "chi", "cosa", "quale", "quanto", "molto", "poco", "tutto", "niente",
            "essere", "avere", "fare", "dire", "andare", "venire", "dare", "prendere", "vedere", "sentire",
            "parlare", "mangiare", "bere", "dormire", "leggere", "scrivere", "studiare", "lavorare", "giocare", "correre",
            "camminare", "saltare", "cantare", "ballare", "ridere", "piangere", "pensare", "sapere", "conoscere", "volere",
            "potere", "dovere", "comprare", "vendere", "aprire", "chiudere", "entrare", "uscire", "trovare", "perdere",
            "aspettare", "cercare", "chiamare", "rispondere", "chiedere", "rispondere", "iniziare", "finire", "cambiare", "aiutare",
            "capire", "spiegare", "imparare", "insegnare", "viaggiare", "visitare", "vivere", "morire", "nascere", "crescere",
            "svegliarsi", "vestirsi", "lavarsi", "pettinarsi", "truccarsi", "sedersi", "alzarsi", "mettere", "togliere", "portare",
            "lasciare", "tornare", "partire", "arrivare", "seguire", "guidare", "costruire", "distruggere", "creare", "distruggere",
            "dipingere", "disegnare", "cucinare", "preparare", "pulire", "sporcare", "rompere", "riparare", "tagliare", "cucire",
            "stirare", "lavare", "asciugare", "piegare", "appendere", "cadere", "spingere", "tirare", "rompere", "riparare",
            "abbracciare", "baciare", "amare", "odiare", "piacere", "dispiacere", "credere", "dubitare", "sperare", "temere",
            "sognare", "ricordare", "dimenticare", "decidere", "scegliere", "provare", "sentire", "toccare", "guardare", "ascoltare",
            "annusare", "gustare", "parlare", "urlare", "sussurrare", "gridare", "cantare", "suonare", "leggere", "scrivere",
            "contare", "calcolare", "misurare", "pesare", "comprare", "vendere", "pagare", "risparmiare", "spendere", "guadagnare",
            "perdere", "vincere", "perdere", "trovare", "cercare", "nascondere", "mostrare", "dare", "ricevere", "inviare",
            "ricevere", "aprire", "chiudere", "accendere", "spegnere", "entrare", "uscire", "salire", "scendere", "sedersi",
            "alzarsi", "correre", "camminare", "nuotare", "volare", "guidare", "viaggiare", "visitare", "esplorare", "scoprire",
            "inventare", "creare", "distruggere", "costruire", "demolire", "pulire", "sporcare", "riordinare", "disordinare", "riempire",
            "svuotare", "tagliare", "cucire", "incollare", "separare", "unire", "dividere", "moltiplicare", "aggiungere", "sottrarre",
            "dividere", "moltiplicare", "sommare", "sottrarre", "dividere", "moltiplicare", "sommare", "sottrarre", "dividere", "moltiplicare",
            "aggiungere", "sottrarre", "parlare", "ascoltare", "vedere", "guardare", "sentire", "toccare", "gustare", "annusare",
            "pensare", "riflettere", "immaginare", "sognare", "ricordare", "dimenticare", "capire", "spiegare", "imparare", "insegnare",
            "studiare", "esaminare", "risolvere", "creare", "distruggere", "costruire", "riparare", "rompere", "aprire", "chiudere",
            "accendere", "spegnere", "entrare", "uscire", "salire", "scendere", "sedersi", "alzarsi", "vestirsi", "svestirsi",
            "lavarsi", "asciugarsi", "pettinarsi", "truccarsi", "radersi", "mangiare", "bere", "cucinare", "preparare", "servire",
            "pulire", "lavare", "stirare", "piegare", "appendere", "stendere", "raccogliere", "seminare", "coltivare", "innaffiare",
            "potare", "raccogliere", "pescare", "cacciare", "guidare", "parcheggiare", "caricare", "scaricare", "guidare", "viaggiare",
            "visitare", "esplorare", "scoprire", "inventare", "creare", "distruggere", "costruire", "demolire", "pulire", "sporcare",
            "riordinare", "disordinare", "riempire", "svuotare", "tagliare", "cucire", "incollare", "separare", "unire", "dividere",
            "moltiplicare", "aggiungere", "sottrarre", "dividere", "moltiplicare", "sommare", "sottrarre", "dividere", "moltiplicare",
            "sommare", "sottrarre", "dividere", "moltiplicare", "aggiungere", "sottrarre", "parlare", "ascoltare", "vedere", "guardare",
            "sentire", "toccare", "gustare", "annusare", "pensare", "riflettere", "immaginare", "sognare", "ricordare", "dimenticare",
            "capire", "spiegare", "imparare", "insegnare", "studiare", "esaminare", "risolvere", "creare", "distruggere", "costruire",
            "riparare", "rompere", "aprire", "chiudere", "accendere", "spegnere", "entrare", "uscire", "salire", "scendere",
            "sedersi", "alzarsi", "vestirsi", "svestirsi", "lavarsi", "asciugarsi", "pettinarsi", "truccarsi", "radersi", "mangiare",
            "bere", "cucinare", "preparare", "servire", "pulire", "lavare", "stirare", "piegare", "appendere", "stendere",
            "raccogliere", "seminare", "coltivare", "innaffiare", "potare", "raccogliere", "pescare", "cacciare", "guidare", "parcheggiare",
            "caricare", "scaricare", "guidare", "viaggiare", "visitare", "esplorare", "scoprire", "inventare", "creare", "distruggere",
            "costruire", "demolire", "pulire", "sporcare", "riordinare", "disordinare", "riempire", "svuotare", "tagliare", "cucire",
            "incollare", "separare", "unire", "dividere", "moltiplicare", "aggiungere", "sottrarre", "dividere", "moltiplicare",
            "sommare", "sottrarre", "dividere", "moltiplicare", "sommare", "sottrarre", "dividere", "moltiplicare", "aggiungere", "sottrarre"
        ];

        // Elementi DOM
        const playerInputSection = document.getElementById('player-input-section');
        const playerNamesInputDiv = document.getElementById('player-name-inputs');
        const startGameBtn = document.getElementById('start-game-btn');
        const gamePlaySection = document.getElementById('game-play-section');
        const playerCardContainer = document.getElementById('player-cards-container');
        const newRoundSamePlayersBtn = document.getElementById('new-round-same-players-btn'); // Nuovo pulsante
        const resetAllGameBtn = document.getElementById('reset-all-game-btn'); // Vecchio reset, rinominato
        const roleModal = document.getElementById('role-modal');
        const modalRoleText = document.getElementById('modal-role-text');
        const modalWordText = document.getElementById('modal-word-text');

        let players = []; // Array per memorizzare i nomi dei giocatori e i loro ruoli
        let secretWord = '';
        const MIN_PLAYERS = 3;
        const MAX_PLAYERS = 10;
        let modalTimeout;

        // Funzione per mescolare un array (algoritmo Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Inizializza i campi di input per i nomi dei giocatori
        function initializePlayerInputs() {
            playerNamesInputDiv.innerHTML = '';
            for (let i = 0; i < MAX_PLAYERS; i++) {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'input-group';
                const label = document.createElement('label');
                label.setAttribute('for', `player-name-${i}`);
                label.textContent = `Giocatore ${i + 1}:`;
                const input = document.createElement('input');
                input.type = 'text';
                input.id = `player-name-${i}`;
                input.placeholder = `Nome Giocatore ${i + 1}`;
                input.className = 'player-name-input';
                if (i >= MIN_PLAYERS) {
                    inputGroup.classList.add('hidden'); // Nasconde gli input oltre il minimo iniziale
                }
                inputGroup.appendChild(label);
                inputGroup.appendChild(input);
                playerNamesInputDiv.appendChild(inputGroup);
            }
            // Mostra solo il numero minimo di input all'inizio
            showPlayerInputs(MIN_PLAYERS);
        }

        // Mostra o nasconde i campi di input in base al numero di giocatori
        function showPlayerInputs(count) {
            const inputs = document.querySelectorAll('.player-name-input');
            inputs.forEach((input, index) => {
                const parentGroup = input.closest('.input-group');
                if (index < count) {
                    parentGroup.classList.remove('hidden');
                } else {
                    parentGroup.classList.add('hidden');
                    input.value = ''; // Pulisce i campi nascosti
                }
            });
        }

        // Listener per il conteggio dei giocatori e la visualizzazione degli input
        playerNamesInputDiv.addEventListener('input', (event) => {
            if (event.target.classList.contains('player-name-input')) {
                const currentInputs = Array.from(document.querySelectorAll('.player-name-input'));
                let filledCount = 0;
                currentInputs.forEach(input => {
                    if (input.value.trim() !== '') {
                        filledCount++;
                    }
                });

                // Mostra un input aggiuntivo se l'ultimo visibile è stato riempito, fino a MAX_PLAYERS
                const lastVisibleInput = currentInputs.findLast(input => !input.closest('.input-group').classList.contains('hidden'));
                if (lastVisibleInput && lastVisibleInput.value.trim() !== '' && filledCount < MAX_PLAYERS) {
                    const nextInputIndex = currentInputs.indexOf(lastVisibleInput) + 1;
                    if (nextInputIndex < MAX_PLAYERS) {
                        currentInputs[nextInputIndex].closest('.input-group').classList.remove('hidden');
                    }
                }
            }
        });

        // Funzione per mostrare il modale con le frasi esplicative
        function showModal(role, word, isImpostor) {
            modalRoleText.textContent = role;
            modalWordText.textContent = word;
            modalRoleText.className = `modal-role ${isImpostor ? 'modal-impostore' : 'modal-socio'}`;
            roleModal.style.display = 'flex'; // Usa flex per centrare il contenuto
            clearTimeout(modalTimeout); // Pulisce timeout precedenti
            modalTimeout = setTimeout(() => {
                roleModal.style.display = 'none';
            }, 5000); // Il modale si chiude dopo 5 secondi
        }

        // Funzione per nascondere il modale
        function hideModal() {
            roleModal.style.display = 'none';
            clearTimeout(modalTimeout);
        }

        // Gestore del click sulla carta del giocatore
        function revealRole(playerIndex) {
            const playerCard = document.getElementById(`player-card-${playerIndex}`);
            if (playerCard.classList.contains('revealed')) {
                return; // Già rivelato, non fare nulla
            }

            const player = players[playerIndex];
            const role = player.isImpostor ? 'IMPOSTORE' : 'SOCIO';
            const word = player.isImpostor ? 'Non conosci la parola segreta!' : secretWord;

            showModal(role, word, player.isImpostor);

            playerCard.classList.add('revealed');
            playerCard.onclick = null; // Rimuove il gestore di eventi per impedire clic multipli
        }

        // Funzione per visualizzare le carte dei giocatori
        function displayPlayerCards() {
            playerCardContainer.innerHTML = '';
            players.forEach((player, index) => {
                const card = document.createElement('button');
                card.id = `player-card-${index}`;
                card.className = 'player-card';
                card.textContent = player.name;
                card.onclick = () => revealRole(index);
                playerCardContainer.appendChild(card);
            });
        }

        // Funzione per iniziare la partita (prima volta o con nuovi giocatori)
        function startGame() {
            players = [];
            const playerNameInputs = document.querySelectorAll('.player-name-input');
            playerNameInputs.forEach(input => {
                const name = input.value.trim();
                if (name !== '') {
                    players.push({ name: name, isImpostor: false });
                }
            });

            if (players.length < MIN_PLAYERS || players.length > MAX_PLAYERS) {
                alert(`Per favore, inserisci tra ${MIN_PLAYERS} e ${MAX_PLAYERS} nomi di giocatori.`);
                return;
            }

            // Inizializza ruoli e parola segreta
            assignRolesAndWord();

            // Nasconde la sezione di input e mostra la sezione di gioco
            playerInputSection.classList.add('hidden');
            gamePlaySection.classList.remove('hidden');

            // Visualizza le carte dei giocatori
            displayPlayerCards();
        }

        // Funzione per assegnare ruoli e parola segreta
        function assignRolesAndWord() {
            // Seleziona una parola segreta casuale
            secretWord = italianWords[Math.floor(Math.random() * italianWords.length)].toUpperCase();

            // Resetta i ruoli di tutti i giocatori
            players.forEach(player => player.isImpostor = false);

            // Assegna il ruolo di Impostore casualmente
            const impostorIndex = Math.floor(Math.random() * players.length);
            players[impostorIndex].isImpostor = true;

            // Mescola i giocatori per rendere imprevedibile l'ordine delle carte
            players = shuffleArray(players);
        }

        // Funzione per iniziare un nuovo round con gli stessi giocatori
        function startNewRoundSamePlayers() {
            // Assicurati che ci siano giocatori dal round precedente
            if (players.length === 0) {
                alert("Non ci sono giocatori per iniziare un nuovo round. Per favore, azzera tutto e rigioca.");
                resetAllGame(); // Torna alla schermata di input se non ci sono giocatori
                return;
            }

            // Assegna nuovi ruoli e una nuova parola segreta
            assignRolesAndWord();

            // Nasconde il modale se è aperto
            hideModal();

            // Ri-visualizza le carte dei giocatori con i nuovi ruoli (non rivelate)
            displayPlayerCards();
        }

        // Funzione per resettare completamente la partita (Azzera Tutto e Rigioca)
        function resetAllGame() {
            players = [];
            secretWord = '';
            playerCardContainer.innerHTML = '';
            hideModal(); // Assicurati che il modale sia nascosto
            gamePlaySection.classList.add('hidden');
            playerInputSection.classList.remove('hidden');
            initializePlayerInputs(); // Re-inizializza gli input dei nomi
        }

        // Aggiungi listener agli eventi
        startGameBtn.addEventListener('click', startGame);
        newRoundSamePlayersBtn.addEventListener('click', startNewRoundSamePlayers); // Nuovo listener
        resetAllGameBtn.addEventListener('click', resetAllGame); // Listener per il reset completo
        roleModal.addEventListener('click', hideModal); // Chiudi il modale cliccando fuori dal contenuto

        // Inizializza al caricamento della pagina
        document.addEventListener('DOMContentLoaded', initializePlayerInputs);
    </script>
</body>
</html>
